import os
import pandas as pd
import streamlit as st

# === 0. 경로/파일 설정 ===
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
CSV_NAME = "직무별_단순빈도_TOP10(final).csv"
CSV_PATH = os.path.join(BASE_DIR, CSV_NAME)

# === 세부 역량 매핑 ===
DETAIL_MAP = {
    '소프트웨어개발': [
        "자료구조와 알고리즘 이해를 바탕으로 한 효율적인 코드 작성 능력",
        "객체지향 프로그래밍(OOP) 설계 및 리팩터링 경험",
        "요구사항 분석 후 기능 단위 모듈 설계 및 구현 경험",
        "테스트 코드 작성 및 단위 테스트/통합 테스트 수행 경험",
        "Git 기반 형상관리 및 협업(브랜치 전략, PR 리뷰) 경험"
    ],
    '웹개발': [
        "HTML/CSS 마크업 기본 및 시맨틱 태그 이해",
        "JavaScript 기본 문법 및 DOM 조작 경험",
        "프론트엔드 프레임워크 사용 경험 (예: React, Vue)",
        "백엔드 API 연동 및 JSON 데이터 처리 경험",
        "반응형 웹 및 크로스 브라우저 이슈 대응 경험"
    ],
    '데이터엔지니어': [
        "대용량 데이터 수집·정제·적재를 위한 ETL 파이프라인 설계 및 구축 경험",
        "관계형/비관계형 데이터베이스(SQL, NoSQL) 설계 및 쿼리 튜닝 경험",
        "Spark, Hadoop 등 분산 처리 프레임워크 활용 경험",
        "데이터 웨어하우스(DW) 및 데이터 레이크 구조 이해",
        "API, 로그, 크롤링 등을 통한 원천 데이터 수집 자동화 경험"
    ],
    '백엔드': [
        "Java/Spring, Django, FastAPI 등 백엔드 프레임워크 기반 서버 개발 경험",
        "RESTful API 설계 및 문서화, 버전 관리 경험",
        "ORM(JPA, Django ORM 등)을 활용한 DB 연동 및 쿼리 최적화 경험",
        "JWT/OAuth2 기반 인증·인가 처리 경험",
        "서버 로깅 및 성능 모니터링을 통한 장애 진단 경험"
    ],
    '서버개발': [
        "Linux 기반 서버 환경에서의 서비스 배포 및 운영 경험",
        "AWS, GCP 등 클라우드 인프라를 활용한 서버 구축 경험",
        "TCP/IP, HTTP 등 네트워크 프로토콜 이해를 바탕으로 한 서버 개발",
        "부하 분산 및 세션 관리 등 대규모 트래픽 처리 구조 이해",
        "시스템 로그 분석을 통한 성능 튜닝 및 장애 대응 경험"
    ],
    'it컨설팅': [
        "고객사의 업무 프로세스 분석 및 문제 정의 경험",
        "ERP, CRM 등 IT 솔루션 도입을 위한 요구사항 정리 및 제안서 작성 경험",
        "PoC(개념 검증) 수행 및 결과를 바탕으로 한 솔루션 제안 경험",
        "데이터 기반 ROI 분석 및 투자 타당성 검토 경험",
        "개발자, 영업, 고객사 등 이해관계자 간 커뮤니케이션 및 조율 경험"
    ],
    '데이터분석가': [
        "Python(Pandas, NumPy)를 활용한 데이터 전처리 및 분석 경험",
        "통계 분석 및 가설 검정을 통한 인사이트 도출 경험",
        "시각화 도구(Matplotlib, Seaborn, Tableau, Power BI 등)를 활용한 리포트 작성 경험",
        "머신러닝 모델(Sklearn 등)을 활용한 분류·회귀·클러스터링 분석 경험",
        "A/B 테스트 설계 및 지표 분석을 통한 의사결정 지원 경험"
    ],
    '머신러닝': [
        "지도학습·비지도학습 등 머신러닝 알고리즘 구현 및 튜닝 경험",
        "피처 엔지니어링 및 하이퍼파라미터 최적화 경험",
        "Sklearn, XGBoost 등 라이브러리를 활용한 모델 개발 경험",
        "교차 검증 및 성능 지표(Accuracy, F1, AUC 등) 기반 모델 평가 경험",
        "모델 결과를 설명하기 위한 XAI 기법(LIME, SHAP 등) 활용 경험"
    ],
    '앱개발': [
        "Android(Kotlin/Java) 또는 iOS(Swift) 기반 네이티브 앱 개발 경험",
        "Flutter, React Native 등 크로스 플랫폼 프레임워크 활용 경험",
        "REST API 연동 및 JSON 데이터 처리 경험",
        "앱 내 상태 관리(State Management) 및 화면 전환 구조 설계 경험",
        "Crash 로그 분석 및 앱 성능 최적화 경험"
    ],
    'it영업': [
        "자사 솔루션의 기술적 특성을 이해하고 고객사에 설명한 경험",
        "기술 제안서, RFP 대응 자료 작성 및 프레젠테이션 경험",
        "PoC 진행을 통한 기술 검증 및 고객 설득 경험",
        "CRM 시스템을 활용한 고객 데이터 관리 및 매출 예측 경험",
        "시장 동향 및 경쟁사 솔루션 비교 분석 경험"
    ],
    '정보보안': [
        "네트워크 보안, 시스템 보안 등 정보보안 기본 개념 이해",
        "방화벽, IDS/IPS 등 보안 장비 운영 경험",
        "취약점 진단 및 모의 해킹 결과 분석 경험",
        "로그 분석을 통한 이상 징후 탐지 및 대응 경험",
        "개인정보보호법 등 관련 컴플라이언스 및 보안 정책 이해"
    ],
    '전자': [
        "마이크로 컨트롤러 및 임베디드 시스템 기본 이해",
        "센서·장치에서 발생하는 데이터 수집 및 처리 경험",
        "펌웨어 업그레이드 및 디버깅 경험",
        "하드웨어와 소프트웨어 간 인터페이스 설계 이해",
        "IoT 디바이스와 클라우드 간 통신 구조 이해"
    ],
    'erp': [
        "재무·회계·인사·생산 등 ERP 주요 모듈 구조 및 데이터 흐름 이해",
        "사용자 요구사항에 따른 화면·리포트 커스터마이징 경험",
        "ERP 내 전표, 마스터 데이터 구조 분석 및 관리 경험",
        "K-Studio 등 ERP 개발도구를 활용한 기능 추가·수정 경험",
        "ERP 도입/전환 프로젝트 지원 및 사용자 교육 경험"
    ],
    '손익관리': [
        "매출·비용 데이터를 활용한 손익 분석 및 리포트 작성 경험",
        "ERP 및 회계 시스템에서 재무 데이터를 추출·가공한 경험",
        "부문별·상품별 손익 구조 분석을 통한 개선 포인트 도출 경험",
        "BI 도구를 활용한 대시보드 구성 및 경영진 보고 경험"
    ],
    'si': [
        "고객사 요구사항 분석 후 시스템 설계 및 커스터마이징 경험",
        "기존 시스템과의 연동을 위한 인터페이스(API, Batch) 설계 경험",
        "DB 마이그레이션 및 데이터 정합성 검증 경험",
        "테스트 시나리오 작성 및 통합 테스트 수행 경험",
        "프로젝트 산출물(설계서, 운영 매뉴얼 등) 작성 경험"
    ],
    '시스템통합': [
        "이기종 시스템 간 데이터 연동 및 인터페이스 설계 경험",
        "API 게이트웨이, 메시지 큐(Kafka, RabbitMQ 등) 활용 경험",
        "데이터 포맷(XML, JSON, CSV 등) 변환 및 표준화 경험",
        "통합 모니터링 및 장애 발생 시 원인 분석 경험"
    ],
    '솔루션업체': [
        "고객사 업무 프로세스 파악 후 솔루션 적용 방안 제안 경험",
        "솔루션 데모 및 PoC 진행을 통한 기능 검증 경험",
        "고객별 요구사항을 반영한 기능 커스터마이징 기획 경험",
        "매뉴얼, 교육자료 등 사용자용 문서 작성 및 교육 진행 경험"
    ],
    'python': [
        "Python을 활용한 자동화 스크립트 및 데이터 처리 경험",
        "Pandas, NumPy를 활용한 데이터 가공 및 분석 경험",
        "웹 프레임워크(Django, Flask, FastAPI) 기반 서비스 구현 경험",
        "외부 API 연동 및 JSON, XML 데이터 처리 경험",
        "가상환경 관리 및 패키지 의존성 관리 경험"
    ],
    'se': [
        "소프트웨어 요구사항 분석 및 명세서 작성 경험",
        "아키텍처 설계 및 설계 문서화 경험",
        "테스트 계획 수립 및 품질 지표 관리 경험",
        "코드 리뷰 및 리팩터링을 통한 품질 개선 경험"
    ],
    '시스템엔지니어': [
        "서버/스토리지/네트워크 등 인프라 환경 구축 및 운영 경험",
        "Linux/Windows 서버 설치 및 계정·권한 관리 경험",
        "시스템 모니터링 도구(Zabbix, Prometheus 등) 활용 경험",
        "장애 발생 시 로그 분석 및 복구 조치 경험",
        "클라우드(IaaS, PaaS) 환경 운영 경험"
    ],
    '네트워크': [
        "TCP/IP, 라우팅, 스위칭 등 네트워크 기본 이론 이해",
        "L2/L3 스위치, 라우터, 방화벽 설정 및 운영 경험",
        "VPN, VLAN 구성 및 네트워크 분리 설계 경험",
        "네트워크 트래픽 분석 및 병목 구간 파악 경험"
    ],
    '솔루션': [
        "제품 기능 이해를 바탕으로 한 고객사 요구사항 매핑 경험",
        "버전 업그레이드 및 패치 적용 계획 수립 경험",
        "솔루션 로그 분석 및 이슈 대응 경험"
    ],
    '앱기획': [
        "사용자 니즈 및 행동 분석을 기반으로 한 기능 기획 경험",
        "와이어프레임, 화면 흐름도(Flow) 설계 경험",
        "로그 데이터 분석을 통한 기능 개선 방향 도출 경험",
        "개발자, 디자이너와의 협업을 위한 명확한 기획 문서 작성 경험"
    ],
    '광고기획': [
        "캠페인 목표에 따른 매체·타겟 전략 수립 경험",
        "GA4, 광고 관리자 등에서 캠페인 성과 지표 분석 경험",
        "데이터를 기반으로 한 광고 소재 및 랜딩페이지 개선 제안 경험",
        "AI 기반 타겟팅 및 자동 입찰 전략 활용 경험"
    ],
    '영업전략': [
        "시장 및 경쟁사 분석을 통한 전략 방향 설정 경험",
        "매출·고객 데이터를 활용한 세그먼트별 전략 수립 경험",
        "CRM 데이터를 기반으로 한 영업활동 효율성 분석 경험",
        "전략 실행 결과를 리포트 형태로 정리·공유한 경험"
    ],
    '영업기획': [
        "영업 활동 데이터 분석을 통한 KPI 설정 및 관리 경험",
        "고객 세그먼트별 매출, 이탈률 분석 경험",
        "영업 프로세스 개선을 위한 시스템 요구사항 정의 경험"
    ],
    '사업관리': [
        "프로젝트 일정·비용·범위 관리를 위한 데이터 기반 계획 수립 경험",
        "손익 및 ROI 분석을 통한 사업 타당성 검토 경험",
        "리스크 관리 항목 정의 및 모니터링 경험"
    ],
    'pm': [
        "프로젝트 범위 정의 및 WBS 작성 경험",
        "개발·디자인·영업 등 다양한 직군과의 커뮤니케이션 및 조율 경험",
        "Jira, Notion 등 협업 도구를 활용한 이슈 및 일정 관리 경험",
        "정량 지표(일정 준수율, 결함 수 등)를 활용한 프로젝트 성과 관리 경험"
    ],
    '프로젝트매니저': [
        "요구사항 변경 관리 및 산출물 검토 경험",
        "리스크 및 이슈 관리 프로세스 운영 경험",
        "고객사 및 내부 팀과의 정기 커뮤니케이션 및 보고 경험"
    ],
    'd기획': [
        "디지털 서비스 사용성 분석 및 UX 개선 기획 경험",
        "데이터 기반 콘텐츠/기능 기획 및 성과 검증 경험",
        "A/B 테스트 설계 및 결과 분석을 통한 개선안 도출 경험"
    ],
    '온라인마케팅': [
        "검색광고, 디스플레이 광고 등 온라인 캠페인 집행 경험",
        "유입 경로 및 전환 데이터 분석을 통한 성과 개선 경험",
        "소셜·콘텐츠 마케팅 성과를 KPI로 관리한 경험"
    ],
    '웹기획': [
        "웹 서비스 IA(Information Architecture) 설계 경험",
        "화면 설계서 및 시나리오 작성 경험",
        "로그 분석 도구를 활용한 사용자 행동 분석 경험",
        "퍼널 분석을 통한 이탈 구간 파악 및 개선안 도출 경험"
    ],
    '웹디자인': [
        "반응형 웹 디자인 및 다양한 해상도에 대응하는 레이아웃 설계 경험",
        "Figma, XD 등을 활용한 UI 시안 제작 및 프로토타입 제작 경험",
        "개발팀과의 협업을 고려한 컴포넌트 기반 디자인 경험"
    ],
    '시각디자인': [
        "브랜드 아이덴티티를 고려한 시각 요소 디자인 경험",
        "데이터 시각화, 인포그래픽 등 정보 전달형 디자인 경험",
        "AI·디자인 툴(예: Midjourney, Firefly) 활용한 작업 효율화 경험"
    ],
    'ui': [
        "사용자 흐름을 고려한 화면 구조 및 인터랙션 설계 경험",
        "디자인 시스템 및 컴포넌트 라이브러리 구성 경험",
        "사용성 테스트 결과를 UI 개선에 반영한 경험"
    ],
    '브랜드디자인': [
        "브랜드 톤앤매너를 시각적으로 일관되게 표현한 경험",
        "브랜드 캠페인 성과를 데이터로 검토하고 디자인 전략에 반영한 경험"
    ],
    '그래픽디자인': [
        "온라인·모바일 환경에 최적화된 그래픽 콘텐츠 제작 경험",
        "AI 그래픽 툴을 활용한 이미지 생성 및 편집 경험",
        "콘텐츠별 클릭률, 체류시간 등 데이터를 고려한 디자인 경험"
    ],
    '영상디자인': [
        "영상 편집 도구를 활용한 홍보/캠페인 영상 제작 경험",
        "썸네일, 타이틀 등 메타 요소 최적화를 통한 조회수 개선 경험",
        "영상 콘텐츠별 시청 유지율 데이터를 분석하여 개선한 경험"
    ],
    'ux디자인': [
        "인터뷰, 설문, 사용성 테스트 등 UX 리서치 수행 경험",
        "사용자 여정 지도(Customer Journey Map) 작성 및 페인포인트 도출 경험",
        "A/B 테스트 및 퍼널 분석을 통한 UX 개선 경험"
    ],
    '배너디자인': [
        "광고 목적에 따른 배너 콘셉트 도출 및 디자인 경험",
        "배너별 CTR, 전환율 등 성과 데이터를 기반으로 한 디자인 개선 경험"
    ],
    '디지털디자인': [
        "웹·모바일 채널에 적합한 디지털 콘텐츠 디자인 경험",
        "모션 그래픽, 인터랙션 등을 활용한 사용자 경험 강화 경험"
    ],
    'sns마케팅': [
        "플랫폼 특성(인스타그램, 유튜브, 틱톡 등)에 맞는 콘텐츠 기획 경험",
        "게시물별 반응(노출, 좋아요, 댓글, 저장 등) 데이터 분석 경험",
        "해시태그, 업로드 시간 등 요소를 테스트하며 성과 개선 경험"
    ],
    '시장조사': [
        "크롤링 및 공공데이터를 활용한 정량·정성 데이터 수집 경험",
        "텍스트 마이닝, 워드클라우드, 토픽모델링 등을 활용한 인사이트 도출 경험",
        "시장 규모, 성장률, 경쟁 구도 등을 구조화하여 리포트 작성 경험"
    ],
    '블로그마케팅': [
        "키워드 분석을 통한 SEO 최적화 콘텐츠 기획 경험",
        "검색 순위, 유입 키워드, 체류시간 데이터 분석 경험",
        "콘텐츠 포맷(리뷰, 인포그래픽 등)에 따른 반응 차이 분석 경험"
    ],
    '퍼포먼스마케팅': [
        "GA4, 광고 플랫폼 리포트 등을 활용한 성과 분석 경험",
        "ROAS, CPA, CTR 등 핵심 지표 기반 캠페인 최적화 경험",
        "고객 세그먼트별 타겟팅 전략 수립 및 테스트 경험"
    ],
    '기획md': [
        "매출·재고 데이터를 활용한 상품 운영 전략 수립 경험",
        "프로모션 기획 후 성과 데이터를 분석하여 개선안 도출 경험",
        "상품 구성과 가격 정책을 데이터 기반으로 결정한 경험"
    ],
    '온라인md': [
        "온라인 채널별 유입·전환 데이터를 기반으로 한 카테고리 운영 경험",
        "AI 추천, 랭킹 정렬 등 기능을 활용한 진열 전략 수립 경험",
        "배너·이벤트 페이지 성과 분석 및 개선 경험"
    ],
    '브랜드md': [
        "브랜드 포지셔닝과 매출 데이터를 함께 고려한 상품 기획 경험",
        "캠페인별 매출 기여도 분석을 통한 브랜드 전략 수립 경험"
    ],
    '영업md': [
        "영업 현장 데이터(매출, 반품, 재고)를 분석하여 상품 운영 전략 수립 경험",
        "거래처별 매출 구조 분석 및 프로모션 제안 경험"
    ],
    '유통md': [
        "물류 리드타임, 재고 회전율 등 데이터를 활용한 재고 관리 경험",
        "수요 예측 및 공급 계획 수립을 위한 데이터 분석 경험"
    ],
    '생산': [
        "생산 실적 및 공정 데이터를 활용한 생산성 분석 경험",
        "ERP/MES 시스템을 통한 작업지시 및 실적 관리 경험",
        "불량률, 가동률 등의 지표를 모니터링하고 개선안을 제안한 경험"
    ],
    '생산기술': [
        "설비 센서 데이터를 활용한 이상 탐지 및 예방보전 분석 경험",
        "공정 조건 데이터 분석을 통한 최적화 및 불량 감소 경험",
        "MES, PLC 등 시스템과의 연동 구조 이해 및 개선 경험"
    ],
    '딥러닝': [
        "CNN, RNN, Transformer 등 딥러닝 모델 구현 경험",
        "TensorFlow, PyTorch를 활용한 모델 학습·튜닝 경험",
        "대용량 데이터 학습 및 GPU 환경 활용 경험",
        "모델 성능 지표를 바탕으로 한 구조 개선 및 하이퍼파라미터 조정 경험"
    ],
    '기계설계': [
        "CAD 도구를 활용한 3D 모델링 및 도면 작성 경험",
        "구조/유동 해석 등 시뮬레이션 결과를 데이터로 분석한 경험",
        "설계 변경 시 성능·원가 등의 영향을 데이터로 검토한 경험"
    ],
    'java': [
        "Java 언어 문법 및 객체지향 설계 원칙 이해",
        "Spring 프레임워크를 활용한 웹 애플리케이션 개발 경험",
        "JDBC, JPA 등을 통한 DB 연동 및 트랜잭션 처리 경험",
        "예외 처리, 로깅 등 안정적인 서버 개발을 위한 기본기 보유"
    ],
    '영업마케팅': [
        "고객 및 매출 데이터를 활용한 타겟 설정 및 전략 수립 경험",
        "CRM 시스템 기반 고객 세분화 및 캠페인 운영 경험",
        "지표 분석을 통한 영업·마케팅 활동 효과 측정 및 개선 경험"
    ],
    '프론트엔드': [
        "HTML/CSS 마크업 및 시맨틱 태그 이해",
        "JavaScript 및 ES6+ 문법 활용 능력",
        "React, Vue 등 프론트엔드 프레임워크 활용 경험",
        "백엔드 API 연동 및 비동기 처리(Ajax, Fetch 등) 경험",
        "반응형 웹 구현 및 브라우저 호환성 이슈 해결 경험",
        "Webpack, Vite 등 번들러 및 프론트 빌드 환경 이해",
        "Git을 활용한 협업 및 코드 리뷰 경험"
    ],
    '세무회계': [
        "세무 신고에 필요한 데이터를 회계 시스템에서 추출·가공한 경험",
        "전자세금계산서, 부가세 신고 등 프로세스 이해 및 시스템 활용 경험",
        "세법 변경 사항을 시스템 설정에 반영하는 과정 지원 경험"
    ],
    '기업회계': [
        "재무제표를 구성하는 계정과목 구조 및 흐름 이해",
        "ERP 회계 모듈을 활용한 전표 입력 및 검증 경험",
        "회계 데이터를 활용한 재무 분석 및 리포트 작성 경험"
    ],
    '회계결산': [
        "월별·분기별 결산 프로세스 이해 및 실무 보조 경험",
        "결산 자료를 기반으로 한 손익 분석 및 리포트 작성 경험",
        "결산 자동화 및 체크리스트 관리 등 시스템 개선 아이디어 제안 경험"
    ],
    '재무회계': [
        "자금 흐름 및 재무제표 분석을 통한 재무 상태 파악 경험",
        "ERP에서 추출한 데이터를 활용한 재무 분석 리포트 작성 경험",
        "재무 관련 지표(유동비율, 부채비율 등)를 활용한 기업 상태 평가 경험"
    ],
    '관리회계': [
        "부문별 손익 및 원가 데이터를 활용한 관리회계 분석 경험",
        "예산 대비 실적 분석 및 차이 원인 파악 경험",
        "관리회계 리포트 자동화를 위한 데이터 구조 설계 경험"
    ]
}


# === 데이터 로드 ===
@st.cache_data
def load_keyword_data():
    if not os.path.exists(CSV_PATH):
        raise FileNotFoundError(f"CSV 파일을 찾을 수 없습니다: {CSV_PATH}")

    try:
        df = pd.read_csv(CSV_PATH, encoding="utf-8-sig")
    except UnicodeDecodeError:
        df = pd.read_csv(CSV_PATH, encoding="cp949")

    required_cols = {"category", "word", "count", "total_posts"}
    missing = required_cols - set(df.columns)
    if missing:
        raise KeyError(f"다음 컬럼이 CSV에 없습니다: {missing}")
    return df


def get_categories(df: pd.DataFrame):
    return sorted(df["category"].dropna().unique().tolist())


def filter_by_category(df: pd.DataFrame, category_value: str):
    filtered = df[df["category"] == category_value].copy()
    filtered = filtered.sort_values("count", ascending=False).reset_index(drop=True)
    filtered.rename(columns={"word": "요구 역량"}, inplace=True)
    return filtered


def main():
    st.set_page_config(page_title="AI 역량 키워드 뷰어", layout="wide")

    # 데이터 읽기
    df = load_keyword_data()
    categories = get_categories(df)

    # 🔲 양옆 여백용 컬럼: 가운데만 사용, 좌우는 여백
    # [3, 6, 3] → 전체 폭 중 가운데 60%, 양쪽 20%씩
    left_col, main_col, right_col = st.columns([3, 6, 3])

    with main_col:
        # 제목
        st.title("📊 분야별 AI 역량 키워드")

        # 직무 선택 (라벨은 빈 문자열: 텍스트 안 보이게)
        selected_category = st.selectbox(
            "",
            options=categories,
            index=0,
        )

        # 해당 분야 필터링
        filtered_df = filter_by_category(df, selected_category)

        # 전체 공고 수 표시
        if "total_posts" in filtered_df.columns:
            st.caption(f"전체 공고 수: {filtered_df['total_posts'].iloc[0]}")

        # 상위 키워드 표
        table_df = filtered_df[["요구 역량", "count"]].copy()
        table_df.index = range(1, len(table_df) + 1)
        st.dataframe(table_df, use_container_width=True)

        # 요구 역량 선택 (라벨은 빈 문자열)
        skill_options = table_df["요구 역량"].tolist()
        if not skill_options:
            st.warning("표시할 요구 역량이 없습니다.")
            return

        selected_skill = st.radio(
            "",
            options=skill_options,
            index=0,
            horizontal=False,
        )

        # 세부 역량 출력
        st.markdown("---")
        st.markdown(f"### 🔍 {selected_skill}의 세부 역량")

        details = DETAIL_MAP.get(selected_skill)
        if details:
            for d in details:
                st.markdown(f"- {d}")
        else:
            st.caption("아직 이 역량에 대한 세부 역량 정보는 준비 중입니다.")


if __name__ == "__main__":
    main()

